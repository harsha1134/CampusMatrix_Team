<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Dashboard - CampusMatrix</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root{
    --jet-stream:#BDD9D7;
    --blue-whale:#03363D;
    --light-bg:#f8fafc;
    --card-bg:#fff;
    --text-light:#64748b;
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Verdana;}

  body{display:flex;min-height:100vh;background:var(--light-bg);color:var(--blue-whale);}

  /* SIDEBAR */
  aside{
    width:260px;
    background:var(--blue-whale);
    color:var(--jet-stream);
    padding:28px;
    display:flex;
    flex-direction:column;
  }
  .logo{font-size:22px;font-weight:700;margin-bottom:25px;display:flex;gap:10px;align-items:center;}
  .menu{list-style:none;padding:0;margin:0;}
  .menu li{
    padding:12px;border-radius:10px;
    cursor:pointer;
    display:flex;align-items:center;gap:10px;margin-bottom:6px;
  }
  .menu li:hover{background:rgba(255,255,255,0.08);}

  /* MAIN CONTENT */
  .content{
    flex:1;padding:26px;overflow:auto;
  }
  h1{margin-bottom:6px;}
  .stats{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:18px;margin-top:20px;margin-bottom:25px;
  }
  .card{
    background:var(--card-bg);
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.05);
    border:1px solid #e5e7eb;
  }
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:12px;
  }
  th,td{
    padding:10px;background:white;border-bottom:1px solid #eee;text-align:left;
  }
  .btn{
    padding:6px 10px;border:none;border-radius:7px;background:var(--jet-stream);
    color:var(--blue-whale);cursor:pointer;font-weight:600;
  }
  .danger{background:#ef4444;color:white;}

  .top-right{
    display:flex;align-items:center;gap:15px;margin-left:auto;
  }

  #search{
    padding:10px;border-radius:10px;border:1px solid #ccc;width:240px;
  }
</style>
</head>

<body>

<!-- SIDEBAR -->
<aside>
  <div class="logo"><i class="fas fa-user-shield"></i> Admin Panel</div>

  <ul class="menu">
    <li><i class="fas fa-gauge"></i> Dashboard</li>
    <li><i class="fas fa-users"></i> Users</li>
    <li><i class="fas fa-flag"></i> Reports</li>
    <li><i class="fas fa-gear"></i> Settings</li>
  </ul>

  <div style="margin-top:auto;">
    <div style="font-size:13px;">Logged in as</div>
    <div id="adminEmail" style="font-weight:700;margin-bottom:10px;">Admin</div>
    <button id="logoutBtn" class="btn" style="width:100%;">Logout</button>
  </div>
</aside>

<!-- MAIN -->
<div class="content">
  <div style="display:flex;align-items:center;">
    <div>
      <h1>Admin Dashboard</h1>
      <p style="color:var(--text-light)">Monitor & manage platform activity</p>
    </div>

    <div class="top-right">
      <input type="text" id="search" placeholder="Search users...">
      <button class="btn" id="refresh"><i class="fas fa-rotate"></i></button>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats">
    <div class="card"><h3>Active Users</h3><p id="userCount" style="font-size:26px;font-weight:bold;">0</p></div>
    <div class="card"><h3>Study Groups</h3><p style="font-size:26px;font-weight:bold;">—</p></div>
    <div class="card"><h3>Events</h3><p style="font-size:26px;font-weight:bold;">—</p></div>
  </div>

  <!-- USERS TABLE -->
  <div class="card">
    <h3>Registered Users</h3>

    <table>
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Student ID</th><th>Year</th><th>Dept</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>
</div>


<!-- DASHBOARD SCRIPT -->
<script>
/* CHECK LOGIN ACCESS */
const admin = JSON.parse(localStorage.getItem("cm_admin") || "null");

if(!admin){
  window.location.href = "admin-login.html";
}

document.getElementById("adminEmail").textContent = admin.email;

/* LOGOUT */
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("cm_admin");
  window.location.href = "admin-login.html";
});

/* LOAD USERS */
function loadUsers(){
  const users = JSON.parse(localStorage.getItem("campusMatrixUsers") || "{}");
  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";
  let count = 0;

  for(const key in users){
    const u = users[key];
    if(!u.studentId) continue;

    count++;

    const row = `
      <tr>
        <td>${u.fullName || "—"}</td>
        <td>${u.collegeEmail || u.personalEmail || "—"}</td>
        <td>${u.studentId}</td>
        <td>${u.year || "—"}</td>
        <td>${u.department || "—"}</td>
        <td>
          <button class="btn" onclick='alert("Name: ${u.fullName}\\nEmail: ${u.collegeEmail}")'>View</button>
          <button class="btn danger" onclick='deleteUser("${u.studentId}")'>Delete</button>
        </td>
      </tr>`;
    tbody.innerHTML += row;
  }

  document.getElementById("userCount").textContent = count;
}

function deleteUser(id){
  if(!confirm("Delete this user?")) return;

  const users = JSON.parse(localStorage.getItem("campusMatrixUsers") || "{}");

  for(const k in users){
    if(users[k].studentId === id){
      delete users[k];
    }
  }

  localStorage.setItem("campusMatrixUsers", JSON.stringify(users));
  loadUsers();
}

document.getElementById("refresh").addEventListener("click", loadUsers);

/* SEARCH FILTER */
document.getElementById("search").addEventListener("input", function(){
  const val = this.value.toLowerCase();
  const rows = document.querySelectorAll("#userTable tr");

  rows.forEach(row => {
    row.style.display = row.textContent.toLowerCase().includes(val) ? "" : "none";
  });
});

loadUsers();
</script>

</body>
</html>
